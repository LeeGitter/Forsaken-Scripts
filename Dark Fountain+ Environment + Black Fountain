-- Services
local lighting = game:GetService("Lighting")
local ws = game:GetService("Workspace")
local lp = game:GetService("Players").LocalPlayer
local tweenService = game:GetService("TweenService")

-- Brighter breach lighting effects
local function applyBreachLighting()
    lighting.ClockTime = 0
    lighting.Brightness = 1.8 -- brighter than before
    lighting.Ambient = Color3.fromRGB(90, 80, 140)
    lighting.OutdoorAmbient = Color3.fromRGB(70, 60, 120)
    lighting.FogColor = Color3.fromRGB(100, 90, 160)
    lighting.FogStart = 0
    lighting.FogEnd = 300

    for _, v in ipairs(lighting:GetChildren()) do
        if v:IsA("Sky") then v:Destroy() end
    end

    if not lighting:FindFirstChild("BreachColor") then
        local cc = Instance.new("ColorCorrectionEffect")
        cc.Name = "BreachColor"
        cc.TintColor = Color3.fromRGB(130, 110, 200)
        cc.Contrast = 0.25
        cc.Saturation = -0.1
        cc.Brightness = 0.05 -- slight lift
        cc.Enabled = true
        cc.Parent = lighting
    end

    if not lighting:FindFirstChild("BreachBloom") then
        local bloom = Instance.new("BloomEffect")
        bloom.Name = "BreachBloom"
        bloom.Intensity = 0.6
        bloom.Size = 48
        bloom.Threshold = 0.8
        bloom.Enabled = true
        bloom.Parent = lighting
    end

    if not lighting:FindFirstChild("BreachAtmosphere") then
        local atm = Instance.new("Atmosphere")
        atm.Name = "BreachAtmosphere"
        atm.Density = 0.5
        atm.Offset = 0.3
        atm.Color = Color3.fromRGB(120, 100, 180)
        atm.Decay = Color3.fromRGB(80, 60, 140)
        atm.Glare = 0.2
        atm.Haze = 2.5
        atm.Enabled = true
        atm.Parent = lighting
    end
end

-- Dash forward 25 studs + 5 upward over 0.1s
local function dashForward()
    local char = lp.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return end

    local goalPos = root.Position + root.CFrame.LookVector * 25 + Vector3.new(0, 5, 0)
    local tween = tweenService:Create(root, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Position = goalPos
    })
    tween:Play()
end

-- Breach trigger on touch
local function setupTouch()
    local darkfountain = ws:FindFirstChild("DarkFountain")
    if not darkfountain or not darkfountain:IsA("BasePart") then return end

    local triggered = false

    darkfountain.Touched:Connect(function(hit)
        if triggered then return end
        if hit:IsDescendantOf(lp.Character) then
            triggered = true

            -- Change DarkFountain color
            darkfountain.Color = Color3.fromRGB(40, 30, 60)
            darkfountain.Material = Enum.Material.SmoothPlastic

            -- Spawn light
            local light = Instance.new("PointLight", darkfountain)
            light.Color = Color3.fromRGB(140, 120, 200)
            light.Range = 25
            light.Brightness = 4

            -- Execute breach sequence
            applyBreachLighting()
            dashForward()
        end
    end)
end

setupTouch()
